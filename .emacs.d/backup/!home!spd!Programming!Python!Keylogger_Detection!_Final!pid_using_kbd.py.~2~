from pathlib import Path
from get_kbd_event import *
from proc import *

def get_pid_using_kbd(all_pids,array_of_keyboard):
    #This function returns PID of process using keyboard events
    pids_using_kbd=[]
    for key_events in array_of_keyboard:
        for pid in all_pids:
            try:
                fp_unresolved=os.listdir(f"/proc/{pid}/fd")
            except FileNotFoundError: #Sometimes immediately after running python keyboard based keylogger random directory is created and deleted
                pass
            for unresolved in fp_unresolved:
                resolved_fp=str(Path(f"/proc/{pid}/fd/{unresolved}").resolve())
                if(resolved_fp==f"/dev/input/event{key_events}"):
                    if(pid not in pids_using_kbd):
                        pids_using_kbd.append(pid)
    return pids_using_kbd

    
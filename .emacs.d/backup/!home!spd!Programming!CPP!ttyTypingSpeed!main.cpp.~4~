#include "box.h"
#include "box_print.h"
#include "controls.h"
#include "cursor_controls.h"
#include "get_time.h"
#include "terminal.h"
#include <iostream>
#include <string>
#include <time.h>
#include <unistd.h>

// Global variables

// Terminal properties
int height = tty_height();
int width = tty_width();

// Time variables
bool timer_started = false;
int initial_time = 0;
unsigned int timer = 5;

// Control Flags
int index_{0};
std::string str = "Hello world this is test string hello world test world test "
                  "test hello\n hello \n";
int buffer[100] = {0};

int main() {

  struct termios initial_state;
  tcgetattr(0, &initial_state);
  sttyCbreak(0); // Put terminal into cbreak mode
  draw_rect(1);
  draw_footer();
  b_printf(str, width);
  char x;
  timer_started = true;
  initial_time = current_time();
  while (timer) {
    mv_xy(2, 2);
    read(0, &x, 1);
    printf("%c", x);
    print_time(5);
    fflush(stdout);
  }

  // Just to restore the terminal
  mv_xy(width, height + 1);
  printf("\n");
  sttyRestore(0, initial_state);
  return 0;
}
